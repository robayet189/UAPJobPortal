<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post New Opportunity - Faculty Dashboard</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Colors */
            --color-black: #000;
            --color-darkgreen: #1b6700;
            --color-darkslateblue-100: #6d68ab;
            --color-darkslateblue-200: #46479d;
            --color-firebrick: #a31e1e;
            --color-gainsboro: #d9d9d9;
            --color-gray: #fefefe;
            --color-honeydew: #d1f0d2;
            --color-lightgreen: #51d784;
            --color-lightsteelblue-100: #a3b9e9;
            --color-lightsteelblue-200: #969dc9;
            --color-midnightblue-100: #21287d;
            --color-midnightblue-200: #131a73;
            --color-midnightblue-300: rgba(33, 40, 125, 0.2);
            --color-plum: #d5b6f0;
            --color-silver: #d9c3c3;
            --color-skyblue: #90d1f1;
            --color-snow: #fffcfc;
            --color-white: #fff;
            --color-lemonchiffon: #fef9c3;

            /* Font Sizes */
            --fs-10: 10px;
            --fs-16: 16px;
            --fs-20: 20px;
            --fs-22: 22px;
            --fs-24: 24px;
            --fs-26: 26px;
            --fs-30: 30px;
            --fs-32: 32px;
            --fs-36: 36px;
            --fs-64: 64px;

            /* Border Radius */
            --br-6: 6px;
            --br-10: 10px;
            --br-14: 14px;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(180deg, rgba(48, 58, 149, 0.2), rgba(118, 25, 125, 0.2) 25%, rgba(173, 0, 107, 0.2) 66%),
                        linear-gradient(rgba(14, 82, 150, 0.2), rgba(14, 82, 150, 0.2)), #303a95;
            color: var(--color-white);
            min-height: 100vh;
            line-height: 1.5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Styles */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 30px;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            width: 60px;
            height: 60px;
            background-color: var(--color-gainsboro);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 20px;
            color: var(--color-darkslateblue-200);
        }

        .logo-text {
            font-size: 24px;
            font-weight: 600;
        }

        .nav-links {
            display: flex;
            gap: 20px;
        }

        .nav-links a {
            color: var(--color-white);
            text-decoration: none;
            padding: 10px 20px;
            border-radius: var(--br-6);
            transition: background-color 0.3s;
        }

        .nav-links a:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .nav-links a.active {
            background-color: var(--color-midnightblue-200);
        }

        /* Page Header */
        .page-header {
            margin-bottom: 30px;
            text-align: center;
        }

        .page-title {
            font-size: 36px;
            margin-bottom: 10px;
        }

        .page-subtitle {
            font-size: 18px;
            color: var(--color-lightsteelblue-200);
        }

        /* Form Styles */
        .form-container {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid var(--color-lightsteelblue-200);
            border-radius: var(--br-14);
            padding: 40px;
            max-width: 800px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 16px;
        }

        .form-control {
            width: 100%;
            padding: 15px;
            border-radius: var(--br-6);
            border: 1px solid var(--color-lightsteelblue-200);
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--color-white);
            font-size: 16px;
            font-family: 'Poppins', sans-serif;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--color-skyblue);
            background-color: rgba(255, 255, 255, 0.15);
        }

        textarea.form-control {
            min-height: 120px;
            resize: vertical;
        }

        .form-row {
            display: flex;
            gap: 20px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn {
            padding: 15px 30px;
            border-radius: var(--br-6);
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
            min-width: 150px;
        }

        .btn-primary {
            background-color: var(--color-lightgreen);
            color: var(--color-darkgreen);
        }

        .btn-primary:hover {
            background-color: #45c570;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: var(--color-midnightblue-300);
            color: var(--color-white);
            border: 2px solid var(--color-midnightblue-100);
        }

        .btn-secondary:hover {
            background-color: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .btn-cancel {
            background-color: transparent;
            color: var(--color-white);
            border: 2px solid var(--color-firebrick);
        }

        .btn-cancel:hover {
            background-color: rgba(163, 30, 30, 0.1);
            transform: translateY(-2px);
        }

        /* Requirements Section */
        .requirements-section {
            margin-top: 10px;
        }

        .requirements-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .requirements-title {
            font-weight: 500;
        }

        .add-requirement-btn {
            background: var(--color-midnightblue-200);
            color: white;
            border: none;
            border-radius: var(--br-6);
            padding: 8px 15px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }

        .add-requirement-btn:hover {
            background: var(--color-darkslateblue-200);
        }

        .requirements-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .requirement-item {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .requirement-input {
            flex: 1;
            padding: 12px;
            border-radius: var(--br-6);
            border: 1px solid var(--color-lightsteelblue-200);
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--color-white);
            font-size: 14px;
        }

        .remove-requirement {
            background: var(--color-firebrick);
            color: white;
            border: none;
            border-radius: var(--br-6);
            width: 35px;
            height: 35px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s;
        }

        .remove-requirement:hover {
            background: #c41a1a;
        }

        /* Alert Styles */
        .alert {
            padding: 15px;
            border-radius: var(--br-6);
            margin-bottom: 20px;
            display: none;
        }

        .alert-success {
            background-color: var(--color-honeydew);
            color: var(--color-darkgreen);
            border: 1px solid var(--color-lightgreen);
        }

        .alert-error {
            background-color: rgba(163, 30, 30, 0.1);
            color: var(--color-white);
            border: 1px solid var(--color-firebrick);
        }

        /* Loading State */
        .btn.loading {
            position: relative;
            color: transparent;
        }

        .btn.loading::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            top: 50%;
            left: 50%;
            margin-left: -10px;
            margin-top: -10px;
            border: 2px solid transparent;
            border-top-color: currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
                gap: 0;
            }

            .form-container {
                padding: 20px;
            }

            .form-actions {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            .requirement-item {
                flex-direction: column;
                align-items: stretch;
            }

            .remove-requirement {
                width: 100%;
                margin-top: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo-section">
                <div class="logo">CSE</div>
                <div class="logo-text">Job Portal</div>
            </div>
            <div class="nav-links">
                <a href="{% url 'faculty_dashboard' %}">Dashboard</a>
                <a href="{% url 'post_opportunity_page' %}" class="active">Post Opportunity</a>
                <a href="{% url 'faculty_profile' %}">Profile</a>
                <a href="{% url 'fcltlog' %}">Logout</a>
            </div>
        </header>

        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title">Post a New Opportunity</h1>
            <p class="page-subtitle">Fill out the form below to create a new opportunity for students</p>
        </div>

        <!-- Alert Messages -->
        <div id="alertMessage" class="alert" style="display: none;"></div>

        <!-- Opportunity Post Form -->
        <div class="form-container">
            <form id="opportunityPostForm">
                <div class="form-group">
                    <label for="opportunityTitle">Opportunity Title *</label>
                    <input type="text" id="opportunityTitle" class="form-control" placeholder="e.g., Teaching Assistant for Data Structures" required>
                </div>

                <div class="form-group">
                    <label for="opportunityDepartment">Department *</label>
                    <input type="text" id="opportunityDepartment" class="form-control" value="CSE Department • University Campus" required>
                </div>

                <div class="form-group">
                    <label for="opportunityDescription">Description *</label>
                    <textarea id="opportunityDescription" class="form-control" placeholder="Describe the opportunity, responsibilities, and what you're looking for in a student..." required></textarea>
                </div>

                <!-- Requirements Section -->
                <div class="form-group">
                    <div class="requirements-header">
                        <label class="requirements-title">Requirements (Optional)</label>
                        <button type="button" class="add-requirement-btn" id="addRequirementBtn">+ Add Requirement</button>
                    </div>
                    <div class="requirements-section">
                        <div class="requirements-list" id="requirementsList">
                            <!-- Requirements will be added here dynamically -->
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="opportunityType">Type *</label>
                        <select id="opportunityType" class="form-control" required>
                            <option value="">Select Opportunity Type</option>
                            <option value="teaching">Teaching Assistant</option>
                            <option value="research">Research Assistant</option>
                            <option value="part_time">Part Time</option>
                            <option value="internship">Internship</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="opportunityApplicants">Expected Applicants</label>
                        <input type="number" id="opportunityApplicants" class="form-control" placeholder="10" min="1">
                    </div>
                </div>

                <div class="form-group">
                    <label for="opportunityDeadline">Application Deadline *</label>
                    <input type="date" id="opportunityDeadline" class="form-control" required>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary" id="submitBtn">
                        Post Opportunity
                    </button>
                    <button type="button" class="btn btn-secondary" id="saveDraftBtn">
                        Save as Draft
                    </button>
                    <a href="{% url 'faculty_dashboard' %}" class="btn btn-cancel">
                        Cancel
                    </a>
                </div>
            </form>
        </div>
    </div>

    <script>
        // CSRF token helper
        function getCSRFToken() {
            const name = 'csrftoken';
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        // Requirements management
        let requirementCount = 0;

        function addRequirement() {
            requirementCount++;
            const requirementsList = document.getElementById('requirementsList');
            const requirementItem = document.createElement('div');
            requirementItem.className = 'requirement-item';
            requirementItem.innerHTML = `
                <input type="text" class="requirement-input" placeholder="Enter a requirement (e.g., Minimum GPA 3.0, Knowledge of Python...)" data-requirement-id="${requirementCount}">
                <button type="button" class="remove-requirement" onclick="removeRequirement(this)">×</button>
            `;
            requirementsList.appendChild(requirementItem);
        }

        function removeRequirement(button) {
            const requirementItem = button.parentElement;
            requirementItem.remove();
        }

        function getRequirements() {
            const requirementInputs = document.querySelectorAll('.requirement-input');
            const requirements = [];
            requirementInputs.forEach(input => {
                if (input.value.trim() !== '') {
                    requirements.push(input.value.trim());
                }
            });
            return requirements;
        }

        // Show alert message
        function showAlert(message, type = 'success') {
            const alertDiv = document.getElementById('alertMessage');
            alertDiv.textContent = message;
            alertDiv.className = `alert alert-${type}`;
            alertDiv.style.display = 'block';

            // Auto hide after 5 seconds
            setTimeout(() => {
                alertDiv.style.display = 'none';
            }, 5000);
        }

        // Set minimum date to today
        document.getElementById('opportunityDeadline').min = new Date().toISOString().split('T')[0];

        // Form submission
        document.getElementById('opportunityPostForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            await submitOpportunity('active');
        });

        // Save as draft
        document.getElementById('saveDraftBtn').addEventListener('click', async function() {
            await submitOpportunity('draft');
        });

        // Add requirement button
        document.getElementById('addRequirementBtn').addEventListener('click', addRequirement);

        async function submitOpportunity(status) {
            const submitBtn = document.getElementById('submitBtn');
            const saveDraftBtn = document.getElementById('saveDraftBtn');
            const originalText = submitBtn.textContent;
            const draftText = saveDraftBtn.textContent;

            try {
                // Show loading state
                submitBtn.textContent = status === 'active' ? 'Posting...' : 'Saving...';
                saveDraftBtn.textContent = 'Saving...';
                submitBtn.disabled = true;
                saveDraftBtn.disabled = true;
                submitBtn.classList.add('loading');
                saveDraftBtn.classList.add('loading');

                const opportunityData = {
                    title: document.getElementById('opportunityTitle').value,
                    department: document.getElementById('opportunityDepartment').value,
                    opportunity_type: document.getElementById('opportunityType').value,
                    description: document.getElementById('opportunityDescription').value,
                    requirements: getRequirements(), // Add requirements to the data
                    expected_applicants: parseInt(document.getElementById('opportunityApplicants').value) || 0,
                    deadline: document.getElementById('opportunityDeadline').value,
                    status: status
                };

                const response = await fetch('/api/opportunities/post/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCSRFToken(),
                    },
                    body: JSON.stringify(opportunityData)
                });

                const result = await response.json();

                if (result.success) {
                    const message = status === 'active'
                        ? 'Opportunity posted successfully! Redirecting to dashboard...'
                        : 'Opportunity saved as draft successfully! Redirecting to dashboard...';

                    showAlert(message, 'success');

                    // Redirect to dashboard after 2 seconds
                    setTimeout(() => {
                        window.location.href = "{% url 'faculty_dashboard' %}";
                    }, 2000);
                } else {
                    showAlert('Error: ' + result.error, 'error');
                }
            } catch (error) {
                console.error('Error posting opportunity:', error);
                showAlert('Failed to post opportunity. Please try again.', 'error');
            } finally {
                // Reset buttons
                submitBtn.textContent = originalText;
                saveDraftBtn.textContent = draftText;
                submitBtn.disabled = false;
                saveDraftBtn.disabled = false;
                submitBtn.classList.remove('loading');
                saveDraftBtn.classList.remove('loading');
            }
        }

        // Add some sample data for testing (optional)
        function fillSampleData() {
            // Remove this function in production
            document.getElementById('opportunityTitle').value = 'Teaching Assistant for Data Structures';
            document.getElementById('opportunityDescription').value = 'We are looking for a motivated Teaching Assistant to support the Data Structures course. Responsibilities include conducting lab sessions, grading assignments, and holding office hours. The ideal candidate should have strong programming skills and excellent communication abilities.';
            document.getElementById('opportunityType').value = 'teaching';
            document.getElementById('opportunityApplicants').value = '5';

            // Add sample requirements
            addRequirement();
            addRequirement();
            addRequirement();

            // Set sample requirement values
            setTimeout(() => {
                const requirementInputs = document.querySelectorAll('.requirement-input');
                if (requirementInputs.length >= 3) {
                    requirementInputs[0].value = 'Minimum GPA 3.0 or above';
                    requirementInputs[1].value = 'Strong knowledge of Python programming';
                    requirementInputs[2].value = 'Completed Data Structures course with grade A';
                }
            }, 100);

            const nextWeek = new Date();
            nextWeek.setDate(nextWeek.getDate() + 7);
            document.getElementById('opportunityDeadline').value = nextWeek.toISOString().split('T')[0];
        }

        // Uncomment the line below to enable sample data filling for testing
        // fillSampleData();
    </script>
</body>
</html>