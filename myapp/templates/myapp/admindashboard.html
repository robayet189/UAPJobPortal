<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Colors */
            --color-black: #000;
            --color-darkslateblue-100: #6d68ab;
            --color-darkslateblue-200: #46479d;
            --color-gainsboro: #d9d9d9;
            --color-gold: #fee213;
            --color-gray: #fefefe;
            --color-honeydew: #dcfce7;
            --color-lavender-100: #f3e8ff;
            --color-lavender-200: #e0e7ff;
            --color-lightsteelblue-100: #a3b9e9;
            --color-lightsteelblue-200: #969dc9;
            --color-lime: #30fa3a;
            --color-midnightblue-100: #21287d;
            --color-midnightblue-200: #131a73;
            --color-midnightblue-300: rgba(33, 40, 125, 0.2);
            --color-palegoldenrod: #f8eeb1;
            --color-plum: #d5b6f0;
            --color-silver: #d9c3c3;
            --color-skyblue: #90d1f1;
            --color-snow: #fffcfc;
            --color-white: #fff;
            --color-success: #4CAF50;
            --color-warning: #FF9800;
            --color-error: #f44336;

            /* Font Sizes */
            --fs-10: 10px;
            --fs-16: 16px;
            --fs-20: 20px;
            --fs-22: 22px;
            --fs-24: 24px;
            --fs-30: 30px;
            --fs-32: 32px;
            --fs-36: 36px;
            --fs-40: 40px;

            /* Border Radius */
            --br-6: 6px;
            --br-10: 10px;
            --br-14: 14px;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(180deg, rgba(48, 58, 149, 0.2), rgba(118, 25, 125, 0.2) 25%, rgba(173, 0, 107, 0.2) 66%),
                        linear-gradient(rgba(14, 82, 150, 0.2), rgba(14, 82, 150, 0.2)), #303a95;
            color: var(--color-white);
            min-height: 100vh;
            line-height: 1.5;
        }

        .dashboard-container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Styles */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 30px;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            width: 80px;
            height: 80px;
            background-color: var(--color-gainsboro);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 24px;
            color: var(--color-darkslateblue-200);
        }

        .logo-text {
            font-size: 28px;
            font-weight: 600;
        }

        .nav-links {
            display: flex;
            gap: 40px;
            font-size: 20px;
        }

        .nav-links a {
            color: var(--color-white);
            text-decoration: none;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: var(--color-skyblue);
        }

        .dashboard-btn {
            background-color: var(--color-midnightblue-300);
            border: 4px solid var(--color-midnightblue-100);
            border-radius: var(--br-6);
            padding: 10px 20px;
            font-weight: 600;
            cursor: pointer;
        }

        /* Dashboard Header */
        .dashboard-header {
            margin-bottom: 30px;
        }

        .dashboard-title {
            font-size: 36px;
            margin-bottom: 10px;
        }

        .welcome-text {
            font-size: 28px;
        }

        .welcome-text span {
            font-weight: 600;
        }

        /* Stats Section */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: var(--br-10);
            padding: 20px;
            text-align: center;
            transition: transform 0.3s;
            cursor: pointer;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card.total-users {
            background-color: var(--color-lightsteelblue-100);
            color: var(--color-black);
        }

        .stat-card.active-jobs {
            background-color: var(--color-honeydew);
            color: var(--color-black);
        }

        .stat-card.pending-reviews {
            background-color: var(--color-palegoldenrod);
            color: var(--color-black);
        }

        .stat-card.companies {
            background-color: var(--color-lavender-100);
            color: var(--color-black);
        }

        .stat-card.new-signups {
            background-color: var(--color-lavender-200);
            color: var(--color-black);
        }

        .stat-card.applications {
            background-color: var(--color-plum);
            color: var(--color-black);
        }

        .stat-title {
            font-size: 16px;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-subtitle {
            font-size: 14px;
            color: rgba(0, 0, 0, 0.7);
        }

        /* Main Content Layout */
        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-top: 40px;
        }

        .content-section {
            background-color: rgba(255, 255, 255, 0.05);
            border: 2px solid var(--color-lightsteelblue-200);
            border-radius: var(--br-14);
            padding: 25px;
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 24px;
            margin-bottom: 20px;
            color: var(--color-skyblue);
        }

        /* Pending Approvals */
        .approval-card {
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--color-lightsteelblue-200);
            border-radius: var(--br-10);
            padding: 20px;
            margin-bottom: 20px;
            transition: transform 0.2s;
        }

        .approval-card:hover {
            transform: translateY(-2px);
        }

        .approval-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .approval-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .approval-subtitle {
            font-size: 16px;
            color: var(--color-gray);
            margin-bottom: 10px;
        }

        .approval-type {
            background-color: var(--color-midnightblue-200);
            color: var(--color-white);
            padding: 4px 8px;
            border-radius: var(--br-6);
            font-size: 12px;
            font-weight: 600;
        }

        .approval-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .approval-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .action-btn {
            padding: 8px 16px;
            border-radius: var(--br-6);
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 14px;
        }

        .view-btn {
            background-color: var(--color-midnightblue-200);
            color: var(--color-white);
        }

        .approve-btn {
            background-color: var(--color-success);
            color: var(--color-white);
        }

        .reject-btn {
            background-color: var(--color-error);
            color: var(--color-white);
        }

        .delete-btn {
            background-color: var(--color-error);
            color: var(--color-white);
        }

        /* Admin Profile Section */
        .profile-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            background-color: var(--color-gainsboro);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 24px;
            color: var(--color-darkslateblue-200);
            margin-right: 15px;
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .profile-position {
            font-size: 16px;
            color: var(--color-gray);
        }

        .profile-details {
            margin-top: 15px;
        }

        .profile-detail {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .profile-detail:last-child {
            border-bottom: none;
        }

        /* System Health Section */
        .health-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .health-item:last-child {
            border-bottom: none;
        }

        .health-status {
            padding: 4px 8px;
            border-radius: var(--br-6);
            font-size: 12px;
            font-weight: 600;
        }

        .status-operational {
            background-color: var(--color-success);
            color: var(--color-white);
        }

        .status-healthy {
            background-color: var(--color-success);
            color: var(--color-white);
        }

        .status-warning {
            background-color: var(--color-warning);
            color: var(--color-white);
        }

        /* Tabs */
        .tabs-container {
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
        }

        .tabs {
            display: flex;
            gap: 30px;
        }

        .tab {
            padding: 12px 0;
            cursor: pointer;
            font-size: 18px;
            position: relative;
            transition: color 0.3s;
        }

        .tab.active {
            color: var(--color-skyblue);
            font-weight: 600;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: var(--color-skyblue);
        }

        /* User Management */
        .add-user-form {
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: var(--br-10);
            padding: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border-radius: var(--br-6);
            border: 1px solid var(--color-lightsteelblue-200);
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--color-white);
            font-size: 14px;
        }

        .form-row {
            display: flex;
            gap: 15px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .user-type-select {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--color-white);
            border: 1px solid var(--color-lightsteelblue-200);
            padding: 10px;
            border-radius: var(--br-6);
            width: 100%;
        }

        /* Activity Log */
        .activity-item {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 10px;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .activity-action {
            font-weight: 600;
            color: var(--color-skyblue);
        }

        .activity-time {
            color: var(--color-silver);
            font-size: 12px;
        }

        .activity-details {
            color: var(--color-gray);
            font-size: 14px;
        }

        /* Footer */
        .footer {
            background: linear-gradient(-51.63deg, #363795 19.62%);
            border-top: 2px solid var(--color-darkslateblue-100);
            padding: 40px 0;
            margin-top: 50px;
        }

        .footer-content {
            max-width: 1800px;
            margin: 0 auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 40px;
        }

        .footer-section h3 {
            font-size: 24px;
            margin-bottom: 20px;
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 10px;
        }

        .footer-links a {
            color: var(--color-white);
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-links a:hover {
            color: var(--color-skyblue);
        }

        .contact-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .copyright {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            margin-top: 30px;
            font-size: 14px;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .stats-container {
                grid-template-columns: repeat(3, 1fr);
            }

            .main-content {
                grid-template-columns: 1fr;
            }

            .footer-content {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 20px;
            }

            .nav-links {
                gap: 20px;
            }

            .stats-container {
                grid-template-columns: 1fr 1fr;
            }

            .approval-actions {
                flex-direction: column;
            }

            .footer-content {
                grid-template-columns: 1fr;
            }

            .tabs {
                flex-wrap: wrap;
                gap: 15px;
            }

            .form-row {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <header class="header">
            <div class="logo-section">
                <div class="logo">CSE</div>
                <div class="logo-text">Job Portal</div>
            </div>
            <div class="nav-links">
                <a href="{% url 'adminlog' %}" class="dashboard-btn">
                    Back
                </a>
            </div>
        </header>

        <!-- Dashboard Header -->
        <section class="dashboard-header">
            <h1 class="dashboard-title">Admin Dashboard</h1>
            <p class="welcome-text">Welcome back, <span id="adminName">Loading...</span></p>
        </section>

        <!-- Stats Section -->
        <section class="stats-container">
            <div class="stat-card total-users" id="totalUsersCard">
                <div class="stat-value" id="totalUsers">0</div>
                <div class="stat-title">Total Users</div>
                <div class="stat-subtitle">All Platform Users</div>
            </div>
            <div class="stat-card active-jobs" id="activeJobsCard">
                <div class="stat-value" id="activeJobs">0</div>
                <div class="stat-title">Active Jobs</div>
                <div class="stat-subtitle">Currently Live</div>
            </div>
            <div class="stat-card pending-reviews" id="pendingReviewsCard">
                <div class="stat-value" id="pendingReviews">0</div>
                <div class="stat-title">Pending Reviews</div>
                <div class="stat-subtitle">Awaiting Approval</div>
            </div>
            <div class="stat-card companies" id="companiesCard">
                <div class="stat-value" id="totalCompanies">0</div>
                <div class="stat-title">Companies</div>
                <div class="stat-subtitle">Registered</div>
            </div>
            <div class="stat-card new-signups" id="newSignupsCard">
                <div class="stat-value" id="newSignups">0</div>
                <div class="stat-title">New Signups</div>
                <div class="stat-subtitle">Last 7 Days</div>
            </div>
            <div class="stat-card applications" id="applicationsCard">
                <div class="stat-value" id="totalApplications">0</div>
                <div class="stat-title">Applications</div>
                <div class="stat-subtitle">Total Submitted</div>
            </div>
        </section>

        <div class="main-content">
            <!-- Left Column -->
            <div class="left-column">
                <!-- Tabs -->
                <div class="tabs-container">
                    <div class="tabs">
                        <div class="tab active" id="pendingTab">Pending Approvals</div>
                        <div class="tab" id="companiesTab">Company Verification</div>
                        <div class="tab" id="usersTab">User Management</div>
                        <div class="tab" id="activityTab">Activity Log</div>
                    </div>
                </div>

                <!-- Content Sections -->
                <div id="tabContent">
                    <!-- Pending Approvals Content -->
                    <section class="content-section" id="pendingContent">
                        <h3 class="section-title">Pending Job Approvals</h3>
                        <div id="pendingApprovalsList">
                            <!-- Pending approvals will be dynamically inserted here -->
                        </div>
                    </section>

                    <!-- Company Verification Content -->
                    <section class="content-section" id="companiesContent" style="display: none;">
                        <h3 class="section-title">Company Verification</h3>
                        <div id="companyVerificationList">
                            <!-- Company verification cards will be inserted here -->
                        </div>
                    </section>

                    <!-- User Management Content -->
                    <section class="content-section" id="usersContent" style="display: none;">
                        <h3 class="section-title">User Management</h3>

                        <!-- Add User Form -->
                        <div class="add-user-form">
                            <h4 style="margin-bottom: 15px; color: var(--color-skyblue);">Add New User</h4>
                            <form id="addUserForm">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="userType">User Type</label>
                                        <select id="userType" class="user-type-select" required>
                                            <option value="">Select User Type</option>
                                            <option value="student">Student</option>
                                            <option value="alumni">Alumni</option>
                                            <option value="faculty">Faculty</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="userEmail">Email</label>
                                        <input type="email" id="userEmail" class="form-control" required>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="firstName">First Name</label>
                                        <input type="text" id="firstName" class="form-control" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="lastName">Last Name</label>
                                        <input type="text" id="lastName" class="form-control" required>
                                    </div>
                                </div>
                                <div class="form-row" id="studentFields">
                                    <div class="form-group">
                                        <label for="studentId">Student ID</label>
                                        <input type="text" id="studentId" class="form-control">
                                    </div>
                                    <div class="form-group">
                                        <label for="graduationYear">Graduation Year</label>
                                        <input type="number" id="graduationYear" class="form-control" min="2020" max="2030">
                                    </div>
                                </div>
                                <div class="form-group" id="facultyFields" style="display: none;">
                                    <label for="position">Position</label>
                                    <input type="text" id="position" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="userPassword">Password</label>
                                    <input type="password" id="userPassword" class="form-control" required>
                                </div>
                                <button type="submit" class="action-btn approve-btn" style="margin-top: 10px;">Add User</button>
                            </form>
                        </div>

                        <!-- Users List -->
                        <div id="usersList" style="margin-top: 20px;">
                            <!-- Users will be dynamically inserted here -->
                        </div>
                    </section>

                    <!-- Activity Log Content -->
                    <section class="content-section" id="activityContent" style="display: none;">
                        <h3 class="section-title">System Activity Log</h3>
                        <div id="activityLogList">
                            <!-- Activity log items will be inserted here -->
                        </div>
                    </section>
                </div>
            </div>

            <!-- Right Column -->
            <div class="right-column">
                <!-- Admin Profile Section -->
                <section class="content-section">
                    <div class="profile-header">
                        <div class="profile-avatar" id="profileAvatar">A</div>
                        <div class="profile-info">
                            <div class="profile-name" id="profileName">Loading...</div>
                            <div class="profile-position" id="profilePosition">Portal Administrator</div>
                        </div>
                    </div>
                    <div class="profile-details">
                        <div class="profile-detail">
                            <span>Email:</span>
                            <span id="profileEmail">Loading...</span>
                        </div>
                        <div class="profile-detail">
                            <span>Phone:</span>
                            <span id="profilePhone">Loading...</span>
                        </div>
                        <div class="profile-detail">
                            <span>Pending Reviews:</span>
                            <span id="profilePendingReviews">0</span>
                        </div>
                        <div class="profile-detail">
                            <span>Tasks Completed:</span>
                            <span id="profileTasksCompleted">0</span>
                        </div>
                        <div class="profile-detail">
                            <span>Last Login:</span>
                            <span id="profileLastLogin">Loading...</span>
                        </div>
                    </div>
                </section>

                <!-- System Health Section -->
                <section class="content-section">
                    <h3 class="section-title">System Health</h3>
                    <div class="health-item">
                        <span>Server Status</span>
                        <span class="health-status status-operational" id="serverStatus">Operational</span>
                    </div>
                    <div class="health-item">
                        <span>Database</span>
                        <span class="health-status status-healthy" id="databaseStatus">Healthy</span>
                    </div>
                    <div class="health-item">
                        <span>Storage</span>
                        <span class="health-status status-warning" id="storageStatus">72% used</span>
                    </div>
                    <div class="health-item">
                        <span>Last Checked</span>
                        <span id="lastChecked">Loading...</span>
                    </div>
                </section>

                <!-- Recent Activity Section -->
                <section class="content-section">
                    <h3 class="section-title">Recent Activity</h3>
                    <div id="recentActivityList">
                        <!-- Recent activity will be dynamically inserted here -->
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>CSE Job Portal</h3>
                <p>Connecting CSE students and alumni with career opportunities in the industry.</p>
            </div>
            <div class="footer-section">
                <h3>Quick Links</h3>
                <ul class="footer-links">
                    <li><a href="{% url 'home' %}">Home</a></li>
                    <li><a href="{% url 'browse_opportunities' %}">Jobs</a></li>
                    <li><a href="{% url 'adminlog' %}">Login</a></li>
                    <li><a href="{% url 'adminreg' %}">Register</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Contact Us</h3>
                <div class="contact-info">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M6.36556 7.6821C7.302 9.3288 8.6712 10.698 10.3179 11.6344L11.2024 10.3961C11.4965 9.9845 12.0516 9.8573 12.4956 10.0998C13.9024 10.8683 15.4571 11.3353 17.0789 11.4637C17.599 11.5049 18 11.9389 18 12.4606V16.9234C18 17.4361 17.6122 17.8657 17.1022 17.9181C16.5723 17.9726 16.0377 18 15.5 18C6.93959 18 0 11.0604 0 2.5C0 1.96227 0.0274201 1.42771 0.0818901 0.89776C0.1343 0.38775 0.56394 0 1.07665 0H5.53942C6.0611 0 6.49513 0.40104 6.5363 0.92109C6.66467 2.54288 7.1317 4.09764 7.9002 5.50444C8.1427 5.9484 8.0155 6.50354 7.6039 6.79757L6.36556 7.6821ZM3.84425 7.0252L5.7442 5.66809C5.20547 4.50514 4.83628 3.27183 4.64727 2H2.00907C2.00303 2.16632 2 2.333 2 2.5C2 9.9558 8.0442 16 15.5 16C15.667 16 15.8337 15.997 16 15.9909V13.3527C14.7282 13.1637 13.4949 12.7945 12.3319 12.2558L10.9748 14.1558C10.4258 13.9425 9.8956 13.6915 9.3874 13.4061L9.3293 13.373C7.3697 12.2587 5.74134 10.6303 4.627 8.6707L4.59394 8.6126C4.30849 8.1044 4.05754 7.5742 3.84425 7.0252Z" fill="white"/>
                    </svg>
                    <span>02-58157091</span>
                </div>
                <div class="contact-info">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 3H21C21.5523 3 22 3.44772 22 4V20C22 20.5523 21.5523 21 21 21H3C2.44772 21 2 20.5523 2 20V4C2 3.44772 2.44772 3 3 3ZM12.0606 11.6829L5.64722 6.2377L4.35278 7.7623L12.0731 14.3171L19.6544 7.75616L18.3456 6.24384L12.0606 11.6829Z" fill="white"/>
                    </svg>
                    <span>cse-jobs@uap-bd.edu</span>
                </div>
            </div>
        </div>
        <div class="copyright">
            <p>&copy; 2025 CSE Department Job Portal. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // CSRF token helper
        function getCSRFToken() {
            const name = 'csrftoken';
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        // Current view state
        let currentView = 'pending';

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Initializing Admin Dashboard...');

            // Load all data
            loadAdminData();
            loadAdminStats();
            loadPendingApprovals(); // Load default tab content
            loadSystemHealth();
            loadRecentActivity();

            // Set up event listeners
            setupEventListeners();

            // Initialize view
            updateActiveTab();
        });

        // Load admin profile data
        async function loadAdminData() {
            try {
                const response = await fetch('/api/admin/profile/');
                const admin = await response.json();

                document.getElementById('adminName').textContent = admin.name;
                document.getElementById('profileName').textContent = admin.name;
                document.getElementById('profileEmail').textContent = admin.email;
                document.getElementById('profilePhone').textContent = admin.phone_number;
                document.getElementById('profileLastLogin').textContent = admin.last_login;
                document.getElementById('profileAvatar').textContent = admin.name.charAt(0).toUpperCase();
            } catch (error) {
                console.error('Error loading admin data:', error);
            }
        }

        // Load admin statistics
        async function loadAdminStats() {
            try {
                const response = await fetch('/api/admin/stats/');
                const stats = await response.json();

                document.getElementById('totalUsers').textContent = stats.total_users;
                document.getElementById('activeJobs').textContent = stats.active_jobs;
                document.getElementById('pendingReviews').textContent = stats.pending_reviews;
                document.getElementById('totalCompanies').textContent = stats.total_companies;
                document.getElementById('newSignups').textContent = stats.new_signups;
                document.getElementById('totalApplications').textContent = stats.total_applications;

                // Update profile stats
                document.getElementById('profilePendingReviews').textContent = stats.pending_reviews;
                document.getElementById('profileTasksCompleted').textContent = Math.floor(Math.random() * 20) + 5;
            } catch (error) {
                console.error('Error loading admin stats:', error);
            }
        }

        // Load pending approvals (Tab 1)
        async function loadPendingApprovals() {
            try {
                const response = await fetch('/api/admin/pending-approvals/');
                const approvals = await response.json();

                const container = document.getElementById('pendingApprovalsList');
                container.innerHTML = '';

                if (approvals.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: var(--color-silver);">
                            No pending approvals at this time.
                        </div>
                    `;
                    return;
                }

                approvals.forEach((approval) => {
                    const approvalCard = document.createElement('div');
                    approvalCard.className = 'approval-card';
                    approvalCard.setAttribute('data-approval-id', approval.id);
                    approvalCard.setAttribute('data-approval-type', approval.type);

                    const isJob = approval.type === 'job';
                    const isFaculty = approval.type === 'faculty_opportunity';
                    const isCompany = approval.type === 'company_job';

                    let typeDisplay, locationDisplay, typeSpecificInfo;

                    if (isJob) {
                        typeDisplay = 'Alumni Job';
                        locationDisplay = approval.location;
                        typeSpecificInfo = approval.job_type;
                    } else if (isFaculty) {
                        typeDisplay = 'Faculty Opportunity';
                        locationDisplay = "University Campus";
                        typeSpecificInfo = approval.opportunity_type;
                    } else if (isCompany) {
                        typeDisplay = 'Company Job';
                        locationDisplay = approval.location;
                        typeSpecificInfo = approval.job_type;
                    }

                    approvalCard.innerHTML = `
                        <div class="approval-header">
                            <div>
                                <div class="approval-title">${approval.title}</div>
                                <div class="approval-subtitle">Submitted by: ${approval.submitted_by} (${approval.submitted_by_type})</div>
                            </div>
                            <div class="approval-type">${typeDisplay}</div>
                        </div>

                        <div class="approval-details">
                            <div><strong>Type:</strong> ${typeSpecificInfo}</div>
                            <div><strong>Location:</strong> ${locationDisplay}</div>
                            <div><strong>Submitted:</strong> ${approval.submitted_at}</div>
                            <div><strong>Deadline:</strong> ${approval.deadline}</div>
                        </div>

                        <div style="margin-bottom: 15px; font-size: 14px; color: var(--color-gray);">
                            ${approval.description.substring(0, 150)}...
                        </div>

                        <div class="approval-actions">
                            <button class="action-btn view-btn" onclick="viewApprovalDetails(${approval.id}, '${approval.type}')">
                                View Details
                            </button>
                            <button class="action-btn approve-btn" onclick="approveItem(${approval.id}, '${approval.type}')">
                                Approve
                            </button>
                            <button class="action-btn reject-btn" onclick="rejectItem(${approval.id}, '${approval.type}')">
                                Reject
                            </button>
                        </div>
                    `;

                    container.appendChild(approvalCard);
                });
            } catch (error) {
                console.error('Error loading pending approvals:', error);
                const container = document.getElementById('pendingApprovalsList');
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #ff4444;">
                        Error loading pending approvals. Please try again.
                    </div>
                `;
            }
        }

        // Load company verification (Tab 2)
        async function loadCompanyVerification() {
            try {
                const response = await fetch('/api/admin/company-verification/');
                const companies = await response.json();

                const container = document.getElementById('companyVerificationList');
                container.innerHTML = '';

                if (companies.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: var(--color-silver);">
                            No companies pending verification.
                        </div>
                    `;
                    return;
                }

                companies.forEach((company) => {
                    const companyCard = document.createElement('div');
                    companyCard.className = 'approval-card';
                    companyCard.setAttribute('data-company-id', company.id);

                    companyCard.innerHTML = `
                        <div class="approval-header">
                            <div>
                                <div class="approval-title">${company.company_name}</div>
                                <div class="approval-subtitle">${company.email}</div>
                            </div>
                            <div class="approval-type">Pending Verification</div>
                        </div>

                        <div class="approval-details">
                            <div><strong>Company Type:</strong> ${company.company_type}</div>
                            <div><strong>Phone:</strong> ${company.phone_number}</div>
                            <div><strong>Registered:</strong> ${company.created_at}</div>
                            <div><strong>Status:</strong> Unverified</div>
                        </div>

                        <div style="margin-bottom: 15px; font-size: 14px; color: var(--color-gray);">
                            Company registration awaiting admin verification.
                        </div>

                        <div class="approval-actions">
                            <button class="action-btn view-btn" onclick="viewCompanyDetails(${company.id})">
                                View Details
                            </button>
                            <button class="action-btn approve-btn" onclick="verifyCompany(${company.id})">
                                Verify Company
                            </button>
                            <button class="action-btn reject-btn" onclick="rejectCompany(${company.id})">
                                Reject
                            </button>
                        </div>
                    `;

                    container.appendChild(companyCard);
                });
            } catch (error) {
                console.error('Error loading company verification:', error);
                const container = document.getElementById('companyVerificationList');
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #ff4444;">
                        Error loading company verification list. Please try again.
                    </div>
                `;
            }
        }

        // Load user management (Tab 3)
        async function loadUserManagement() {
            try {
                const response = await fetch('/api/admin/users/');
                const users = await response.json();

                const container = document.getElementById('usersList');
                container.innerHTML = '';

                if (users.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: var(--color-silver);">
                            No users found.
                        </div>
                    `;
                    return;
                }

                let usersHTML = `
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: var(--color-skyblue); margin-bottom: 15px;">Existing Users</h4>
                    </div>
                `;

                users.forEach(user => {
                    const statusColor = user.is_verified ? 'var(--color-success)' : 'var(--color-warning)';
                    const userTypeDisplay = user.user_type.charAt(0).toUpperCase() + user.user_type.slice(1);

                    usersHTML += `
                        <div class="approval-card">
                            <div class="approval-header">
                                <div>
                                    <div class="approval-title">${user.first_name} ${user.last_name}</div>
                                    <div class="approval-subtitle">${user.email}</div>
                                </div>
                                <div class="approval-type" style="background-color: ${statusColor};">${userTypeDisplay}</div>
                            </div>
                            <div class="approval-details">
                                <div><strong>User ID:</strong> ${user.id}</div>
                                <div><strong>Status:</strong> ${user.is_verified ? 'Verified' : 'Unverified'}</div>
                                <div><strong>Registered:</strong> ${user.created_at}</div>
                                ${user.student_id ? `<div><strong>Student ID:</strong> ${user.student_id}</div>` : ''}
                                ${user.graduation_year ? `<div><strong>Graduation:</strong> ${user.graduation_year}</div>` : ''}
                                ${user.position ? `<div><strong>Position:</strong> ${user.position}</div>` : ''}
                            </div>
                            <div class="approval-actions">
                                <button class="action-btn view-btn" onclick="viewUserDetails(${user.id}, '${user.user_type}')">
                                    View Profile
                                </button>
                                <button class="action-btn delete-btn" onclick="deleteUser(${user.id}, '${user.user_type}')">
                                    Delete User
                                </button>
                            </div>
                        </div>
                    `;
                });

                container.innerHTML = usersHTML;

            } catch (error) {
                console.error('Error loading user management:', error);
                const container = document.getElementById('usersList');
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #ff4444;">
                        Error loading users. Please try again.
                    </div>
                `;
            }
        }

        // Load activity log (Tab 4)
        async function loadActivityLog() {
            try {
                const response = await fetch('/api/admin/activity-log/');
                const activities = await response.json();

                const container = document.getElementById('activityLogList');
                container.innerHTML = '';

                if (activities.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: var(--color-silver);">
                            No activity recorded yet.
                        </div>
                    `;
                    return;
                }

                activities.forEach(activity => {
                    const activityItem = document.createElement('div');
                    activityItem.className = 'activity-item';

                    activityItem.innerHTML = `
                        <div class="activity-header">
                            <span class="activity-action">${activity.action}</span>
                            <span class="activity-time">${activity.timestamp}</span>
                        </div>
                        <div class="activity-details">
                            ${activity.details}
                        </div>
                    `;

                    container.appendChild(activityItem);
                });

            } catch (error) {
                console.error('Error loading activity log:', error);
                const container = document.getElementById('activityLogList');
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #ff4444;">
                        Error loading activity log. Please try again.
                    </div>
                `;
            }
        }

        // Load system health
        async function loadSystemHealth() {
            try {
                const response = await fetch('/api/admin/system-health/');
                const health = await response.json();

                document.getElementById('serverStatus').textContent = health.server_status;
                document.getElementById('databaseStatus').textContent = health.database_status;
                document.getElementById('storageStatus').textContent = `${health.storage_used}% used`;
                document.getElementById('lastChecked').textContent = health.last_checked;

                // Update status classes based on values
                const serverStatus = document.getElementById('serverStatus');
                const databaseStatus = document.getElementById('databaseStatus');
                const storageStatus = document.getElementById('storageStatus');

                serverStatus.className = `health-status ${health.server_status === 'operational' ? 'status-operational' : 'status-warning'}`;
                databaseStatus.className = `health-status ${health.database_status === 'healthy' ? 'status-healthy' : 'status-warning'}`;
                storageStatus.className = `health-status ${health.storage_used > 80 ? 'status-warning' : 'status-healthy'}`;

            } catch (error) {
                console.error('Error loading system health:', error);
            }
        }

        // Load recent activity
        async function loadRecentActivity() {
            try {
                const response = await fetch('/api/admin/recent-activity/');
                const activity = await response.json();

                const container = document.getElementById('recentActivityList');
                container.innerHTML = '';

                if (activity.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 20px; color: var(--color-silver);">
                            No recent activity.
                        </div>
                    `;
                    return;
                }

                activity.forEach((item) => {
                    const activityItem = document.createElement('div');
                    activityItem.className = 'health-item';
                    activityItem.innerHTML = `
                        <div>
                            <strong>${item.name}</strong><br>
                            <small style="color: var(--color-silver);">${item.type.charAt(0).toUpperCase() + item.type.slice(1)} Signup</small>
                        </div>
                        <div style="text-align: right;">
                            <div>${item.time}</div>
                            <small style="color: var(--color-silver);">${item.date}</small>
                        </div>
                    `;
                    container.appendChild(activityItem);
                });
            } catch (error) {
                console.error('Error loading recent activity:', error);
            }
        }

        // Tab content loader
        function loadTabContent(tabName) {
            // Hide all content sections
            document.getElementById('pendingContent').style.display = 'none';
            document.getElementById('companiesContent').style.display = 'none';
            document.getElementById('usersContent').style.display = 'none';
            document.getElementById('activityContent').style.display = 'none';

            // Show loading state
            const container = document.getElementById('pendingApprovalsList');

            // Load appropriate content based on tab
            switch(tabName) {
                case 'pending':
                    document.getElementById('pendingContent').style.display = 'block';
                    loadPendingApprovals();
                    break;
                case 'companies':
                    document.getElementById('companiesContent').style.display = 'block';
                    loadCompanyVerification();
                    break;
                case 'users':
                    document.getElementById('usersContent').style.display = 'block';
                    loadUserManagement();
                    break;
                case 'activity':
                    document.getElementById('activityContent').style.display = 'block';
                    loadActivityLog();
                    break;
                default:
                    document.getElementById('pendingContent').style.display = 'block';
                    loadPendingApprovals();
            }
        }

        // Update active tab styling and content
        function updateActiveTab() {
            const tabs = ['pendingTab', 'companiesTab', 'usersTab', 'activityTab'];

            // Remove active class from all tabs
            tabs.forEach(tab => {
                document.getElementById(tab).classList.remove('active');
            });

            // Add active class to current tab
            document.getElementById(currentView + 'Tab').classList.add('active');

            // Load the content for the active tab
            loadTabContent(currentView);
        }

        // Set up event listeners
        function setupEventListeners() {
            // Tab switching
            const tabs = ['pendingTab', 'companiesTab', 'usersTab', 'activityTab'];
            tabs.forEach(tab => {
                document.getElementById(tab).addEventListener('click', function() {
                    currentView = tab.replace('Tab', '');
                    updateActiveTab();
                });
            });

            // User type selection handler
            document.getElementById('userType').addEventListener('change', function() {
                const userType = this.value;
                document.getElementById('studentFields').style.display = userType === 'student' || userType === 'alumni' ? 'flex' : 'none';
                document.getElementById('facultyFields').style.display = userType === 'faculty' ? 'block' : 'none';
            });

            // Add user form submission
            document.getElementById('addUserForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addNewUser();
            });
        }

        // Approval management functions
        async function approveItem(itemId, itemType) {
            if (confirm('Are you sure you want to approve this item?')) {
                try {
                    const response = await fetch(`/api/admin/approve/${itemType}/${itemId}/`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': getCSRFToken(),
                        }
                    });

                    const result = await response.json();
                    if (result.success) {
                        alert('Item approved successfully!');
                        // Reload data
                        loadAdminStats();
                        loadTabContent(currentView);
                        logActivity(`Approved ${itemType}: ${itemId}`, 'approval');
                    } else {
                        alert('Error: ' + result.error);
                    }
                } catch (error) {
                    console.error('Error approving item:', error);
                    alert('Failed to approve item. Please try again.');
                }
            }
        }

        async function rejectItem(itemId, itemType) {
            if (confirm('Are you sure you want to reject this item?')) {
                try {
                    const response = await fetch(`/api/admin/reject/${itemType}/${itemId}/`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': getCSRFToken(),
                        }
                    });

                    const result = await response.json();
                    if (result.success) {
                        alert('Item rejected successfully!');
                        // Reload data
                        loadAdminStats();
                        loadTabContent(currentView);
                        logActivity(`Rejected ${itemType}: ${itemId}`, 'rejection');
                    } else {
                        alert('Error: ' + result.error);
                    }
                } catch (error) {
                    console.error('Error rejecting item:', error);
                    alert('Failed to reject item. Please try again.');
                }
            }
        }

        // Company verification functions
        async function verifyCompany(companyId) {
            if (confirm('Are you sure you want to verify this company?')) {
                try {
                    const response = await fetch(`/api/admin/verify-company/${companyId}/`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': getCSRFToken(),
                        }
                    });

                    const result = await response.json();
                    if (result.success) {
                        alert('Company verified successfully!');
                        loadAdminStats();
                        loadTabContent(currentView);
                        logActivity(`Verified company: ${companyId}`, 'verification');
                    } else {
                        alert('Error: ' + result.error);
                    }
                } catch (error) {
                    console.error('Error verifying company:', error);
                    alert('Failed to verify company. Please try again.');
                }
            }
        }

        async function rejectCompany(companyId) {
            if (confirm('Are you sure you want to reject this company?')) {
                try {
                    const response = await fetch(`/api/admin/reject-company/${companyId}/`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': getCSRFToken(),
                        }
                    });

                    const result = await response.json();
                    if (result.success) {
                        alert('Company rejected successfully!');
                        loadAdminStats();
                        loadTabContent(currentView);
                        logActivity(`Rejected company: ${companyId}`, 'rejection');
                    } else {
                        alert('Error: ' + result.error);
                    }
                    } catch (error) {
                    console.error('Error rejecting company:', error);
                    alert('Failed to reject company. Please try again.');
                }
            }
        }

        // User management functions
        async function addNewUser() {
            const form = document.getElementById('addUserForm');
            const formData = new FormData(form);
            const userType = document.getElementById('userType').value;

            const userData = {
                user_type: userType,
                email: document.getElementById('userEmail').value,
                first_name: document.getElementById('firstName').value,
                last_name: document.getElementById('lastName').value,
                password: document.getElementById('userPassword').value
            };

            if (userType === 'student' || userType === 'alumni') {
                userData.student_id = document.getElementById('studentId').value;
                userData.graduation_year = document.getElementById('graduationYear').value;
            }

            if (userType === 'faculty') {
                userData.position = document.getElementById('position').value;
            }

            try {
                const response = await fetch('/api/admin/add-user/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCSRFToken(),
                    },
                    body: JSON.stringify(userData)
                });

                const result = await response.json();
                if (result.success) {
                    alert('User added successfully!');
                    form.reset();
                    loadTabContent(currentView);
                    loadAdminStats();
                    logActivity(`Added ${userType} user: ${userData.email}`, 'user_management');
                } else {
                    alert('Error: ' + result.error);
                }
            } catch (error) {
                console.error('Error adding user:', error);
                alert('Failed to add user. Please try again.');
            }
        }

        async function deleteUser(userId, userType) {
            if (confirm('Are you sure you want to delete this user? This action cannot be undone.')) {
                try {
                    const response = await fetch(`/api/admin/delete-user/${userType}/${userId}/`, {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': getCSRFToken(),
                        }
                    });

                    const result = await response.json();
                    if (result.success) {
                        alert('User deleted successfully!');
                        loadTabContent(currentView);
                        loadAdminStats();
                        logActivity(`Deleted ${userType} user: ${userId}`, 'user_management');
                    } else {
                        alert('Error: ' + result.error);
                    }
                } catch (error) {
                    console.error('Error deleting user:', error);
                    alert('Failed to delete user. Please try again.');
                }
            }
        }

        // View details functions
        function viewApprovalDetails(itemId, itemType) {
            alert(`Viewing details for ${itemType} with ID: ${itemId}\n\nThis would open a detailed modal with full information.`);
        }

        function viewCompanyDetails(companyId) {
            alert(`Viewing company details for ID: ${companyId}\n\nThis would show complete company registration information.`);
        }

        function viewUserDetails(userId, userType) {
            alert(`Viewing user profile for ${userType} with ID: ${userId}\n\nThis would show complete user profile information.`);
        }

        // Activity logging function
        async function logActivity(action, type) {
            try {
                await fetch('/api/admin/log-activity/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCSRFToken(),
                    },
                    body: JSON.stringify({
                        action: action,
                        type: type,
                        timestamp: new Date().toISOString()
                    })
                });
            } catch (error) {
                console.error('Error logging activity:', error);
            }
        }

        // Auto-refresh data every 30 seconds
        setInterval(() => {
            loadAdminStats();
            loadSystemHealth();
            if (currentView === 'pending') {
                loadTabContent('pending');
            }
        }, 30000);
    </script>
</body>
</html>