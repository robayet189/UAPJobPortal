<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Faculty Dashboard</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Colors */
            --color-black: #000;
            --color-darkgreen: #1b6700;
            --color-darkslateblue-100: #6d68ab;
            --color-darkslateblue-200: #46479d;
            --color-firebrick: #a31e1e;
            --color-gainsboro: #d9d9d9;
            --color-gray: #fefefe;
            --color-honeydew: #d1f0d2;
            --color-lightgreen: #51d784;
            --color-lightsteelblue-100: #a3b9e9;
            --color-lightsteelblue-200: #969dc9;
            --color-midnightblue-100: #21287d;
            --color-midnightblue-200: #131a73;
            --color-midnightblue-300: rgba(33, 40, 125, 0.2);
            --color-plum: #d5b6f0;
            --color-silver: #d9c3c3;
            --color-skyblue: #90d1f1;
            --color-snow: #fffcfc;
            --color-white: #fff;
            --color-lemonchiffon: #fef9c3;

            /* Font Sizes */
            --fs-10: 10px;
            --fs-16: 16px;
            --fs-20: 20px;
            --fs-22: 22px;
            --fs-24: 24px;
            --fs-26: 26px;
            --fs-30: 30px;
            --fs-32: 32px;
            --fs-36: 36px;
            --fs-64: 64px;

            /* Border Radius */
            --br-6: 6px;
            --br-10: 10px;
            --br-14: 14px;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(180deg, rgba(48, 58, 149, 0.2), rgba(118, 25, 125, 0.2) 25%, rgba(173, 0, 107, 0.2) 66%),
                        linear-gradient(rgba(14, 82, 150, 0.2), rgba(14, 82, 150, 0.2)), #303a95;
            color: var(--color-white);
            min-height: 100vh;
            line-height: 1.5;
        }

        .dashboard-container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Styles */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 30px;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            width: 80px;
            height: 80px;
            background-color: var(--color-gainsboro);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 24px;
            color: var(--color-darkslateblue-200);
        }

        .logo-text {
            font-size: 28px;
            font-weight: 600;
        }

        .nav-links {
            display: flex;
            gap: 40px;
            font-size: 20px;
        }

        .nav-links a {
            color: var(--color-white);
            text-decoration: none;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: var(--color-skyblue);
        }

        .dashboard-btn {
            background-color: var(--color-midnightblue-300);
            border: 4px solid var(--color-midnightblue-100);
            border-radius: var(--br-6);
            padding: 10px 20px;
            font-weight: 600;
            cursor: pointer;
        }

        /* Dashboard Header */
        .dashboard-header {
            margin-bottom: 30px;
        }

        .dashboard-title {
            font-size: 36px;
            margin-bottom: 10px;
        }

        .welcome-text {
            font-size: 28px;
        }

        .welcome-text span {
            font-weight: 600;
        }

        /* Stats Section */
        .stats-container {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
        }

        .stat-card {
            flex: 1;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: var(--br-10);
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
            cursor: pointer;
            text-align: center;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card.students {
            background-color: var(--color-honeydew);
            color: var(--color-black);
        }

        .stat-card.opportunities {
            background-color: var(--color-lightsteelblue-100);
            color: var(--color-black);
        }

        .stat-card.hired {
            background-color: var(--color-plum);
            color: var(--color-black);
        }

        .stat-card.applied {
            background-color: var(--color-lemonchiffon);
            color: var(--color-black);
        }

        .stat-title {
            font-size: 22px;
            margin-bottom: 15px;
        }

        .stat-value {
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .stat-subtitle {
            font-size: 18px;
        }

        /* Opportunities Section */
        .opportunities-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 28px;
            font-weight: 600;
        }

        .post-opportunity-btn {
            background-color: var(--color-midnightblue-200);
            border: none;
            border-radius: var(--br-6);
            padding: 15px 25px;
            color: var(--color-white);
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .post-opportunity-btn:hover {
            background-color: var(--color-darkslateblue-200);
        }

        /* Tabs */
        .tabs-container {
            margin-bottom: 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
        }

        .tabs {
            display: flex;
            justify-content: flex-start;
            gap: 600px;
        }

        .tab {
            padding: 12px 0;
            cursor: pointer;
            font-size: 20px;
            position: relative;
            transition: color 0.3s;
        }

        .tab.active {
            color: var(--color-skyblue);
            font-weight: 600;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: var(--color-skyblue);
        }

        /* Opportunity Cards */
        .opportunity-cards-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 25px;
            margin-bottom: 40px;
        }

        .opportunity-card {
            background-color: rgba(255, 255, 255, 0.05);
            border: 2px solid var(--color-lightsteelblue-200);
            border-radius: var(--br-14);
            padding: 25px;
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }

        .opportunity-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .opportunity-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .opportunity-title {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .opportunity-department {
            font-size: 24px;
            color: var(--color-gray);
            margin-bottom: 15px;
        }

        .opportunity-status {
            background-color: var(--color-lightgreen);
            color: var(--color-darkgreen);
            padding: 5px 12px;
            border-radius: var(--br-10);
            font-weight: 600;
            font-size: 14px;
        }

        .opportunity-details {
            display: flex;
            gap: 30px;
            margin-bottom: 20px;
            font-size: 18px;
        }

        .opportunity-meta {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .opportunity-tag {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 5px 12px;
            border-radius: var(--br-10);
            font-size: 14px;
        }

        .opportunity-actions {
            display: flex;
            gap: 15px;
        }

        .action-btn {
            padding: 10px 20px;
            border-radius: var(--br-6);
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .view-applicants {
            background-color: var(--color-midnightblue-200);
            color: var(--color-white);
        }

        .edit-opportunity {
            background-color: var(--color-midnightblue-300);
            color: var(--color-white);
            border: 2px solid var(--color-midnightblue-100);
        }

        .close-opportunity {
            background-color: transparent;
            color: var(--color-white);
            border: 2px solid var(--color-firebrick);
        }

        /* Sidebar Sections */
        .sidebar-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-top: 40px;
        }

        .main-content {
            grid-column: 1;
        }

        .sidebar {
            grid-column: 2;
        }

        .sidebar-section {
            background-color: rgba(255, 255, 255, 0.05);
            border: 2px solid var(--color-lightsteelblue-200);
            border-radius: var(--br-14);
            padding: 25px;
            margin-bottom: 30px;
        }

        .sidebar-title {
            font-size: 24px;
            margin-bottom: 20px;
            color: var(--color-skyblue);
        }

        .applicant-item {
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .applicant-item:last-child {
            border-bottom: none;
        }

        .applicant-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .applicant-position {
            font-size: 14px;
            color: var(--color-gray);
            margin-bottom: 5px;
        }

        .applicant-time {
            font-size: 12px;
            color: var(--color-silver);
        }

        .view-all-btn {
            background-color: var(--color-midnightblue-200);
            color: var(--color-white);
            border: none;
            border-radius: var(--br-6);
            padding: 10px 20px;
            width: 100%;
            margin-top: 15px;
            cursor: pointer;
        }

        /* Profile Section */
        .profile-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            background-color: var(--color-gainsboro);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 24px;
            color: var(--color-darkslateblue-200);
            margin-right: 15px;
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .profile-position {
            font-size: 16px;
            color: var(--color-gray);
        }

        .profile-details {
            margin-top: 15px;
        }

        .profile-detail {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .profile-detail:last-child {
            border-bottom: none;
        }

        .edit-profile-btn {
            background-color: transparent;
            color: var(--color-white);
            border: 1px solid var(--color-white);
            border-radius: var(--br-6);
            padding: 8px 15px;
            cursor: pointer;
            margin-top: 15px;
            width: 100%;
        }

        /* Footer */
        .footer {
            background: linear-gradient(-51.63deg, #363795 19.62%);
            border-top: 2px solid var(--color-darkslateblue-100);
            padding: 40px 0;
            margin-top: 50px;
        }

        .footer-content {
            max-width: 1800px;
            margin: 0 auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 40px;
        }

        .footer-section h3 {
            font-size: 24px;
            margin-bottom: 20px;
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 10px;
        }

        .footer-links a {
            color: var(--color-white);
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-links a:hover {
            color: var(--color-skyblue);
        }

        .contact-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .copyright {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            margin-top: 30px;
            font-size: 14px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: linear-gradient(135deg, #303a95, #46479d);
            border: 2px solid var(--color-lightsteelblue-200);
            border-radius: 10px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            color: white;
            position: relative;
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }

        .modal-title {
            font-size: 28px;
            margin-bottom: 20px;
            color: var(--color-skyblue);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border-radius: var(--br-6);
            border: 1px solid var(--color-lightsteelblue-200);
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--color-white);
            font-size: 16px;
        }

        .form-row {
            display: flex;
            gap: 15px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .modal-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 25px;
        }

        .btn {
            padding: 12px 25px;
            border-radius: var(--br-6);
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .btn-primary {
            background-color: var(--color-lightgreen);
            color: var(--color-darkgreen);
        }

        .btn-secondary {
            background-color: var(--color-silver);
            color: var(--color-black);
        }

        .btn-cancel {
            background-color: transparent;
            color: var(--color-white);
            border: 1px solid var(--color-white);
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .footer-content {
                grid-template-columns: 1fr 1fr;
            }

            .sidebar-container {
                grid-template-columns: 1fr;
            }

            .sidebar {
                grid-column: 1;
            }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 20px;
            }

            .nav-links {
                gap: 20px;
            }

            .stats-container {
                flex-direction: column;
            }

            .opportunity-actions {
                flex-direction: column;
            }

            .footer-content {
                grid-template-columns: 1fr;
            }

            .form-row {
                flex-direction: column;
                gap: 0;
            }

            .tabs {
                display: flex !important;
                justify-content: space-between !important;
                width: 100% !important;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <header class="header">
            <div class="logo-section">
                <div class="logo">CSE</div>
                <div class="logo-text">Job Portal</div>
            </div>
            <div class="nav-links">
                <a href="{% url 'fcltlog' %}" class="dashboard-btn">
                    Back
                </a>
            </div>
        </header>

        <!-- Dashboard Header -->
        <section class="dashboard-header">
            <h1 class="dashboard-title">Faculty Dashboard</h1>
            <p class="welcome-text">Welcome back, <span id="facultyName">Loading...</span></p>
        </section>

        <!-- Stats Section -->
        <section class="stats-container">
            <div class="stat-card students" id="studentsCard">
                <h3 class="stat-title">Total Students</h3>
                <div class="stat-value" id="totalStudents">0</div>
                <p class="stat-subtitle">Registered Students</p>
            </div>
            <div class="stat-card opportunities" id="opportunitiesCard">
                <h3 class="stat-title">Posted Opportunities</h3>
                <div class="stat-value" id="totalOpportunities">0</div>
                <p class="stat-subtitle">Active Listings</p>
            </div>
            <div class="stat-card hired" id="hiredCard">
                <h3 class="stat-title">Students Hired</h3>
                <div class="stat-value" id="totalHired">0</div>
                <p class="stat-subtitle">Successfully Placed</p>
            </div>
            <div class="stat-card applied" id="appliedCard">
                <h3 class="stat-title">Students Applied</h3>
                <div class="stat-value" id="totalApplied">0</div>
                <p class="stat-subtitle">Total Applications</p>
            </div>
        </section>

        <div class="sidebar-container">
            <!-- Main Content -->
            <div class="main-content">
                <!-- Opportunities Section -->
                <section class="opportunities">
                    <div class="opportunities-header">
                        <h2 class="section-title">Your Opportunities</h2>
                        <a href="{% url 'post_opportunity_page' %}" class="post-opportunity-btn" id="postNewOpportunityBtn">+ Post New Opportunity</a>
                    </div>

                    <!-- Tabs -->
                    <div class="tabs-container">
                        <div class="tabs">
                            <div class="tab active" id="activeTab">Active</div>
                            <div class="tab" id="pendingTab">Pending Approval</div>
                            <div class="tab" id="closedTab">Closed</div>
                        </div>
                    </div>

                    <!-- Opportunity Cards -->
                    <div id="opportunityCardsContainer" class="opportunity-cards-container">
                        <!-- Opportunity cards will be dynamically inserted here -->
                    </div>
                </section>
            </div>

            <!-- Sidebar -->
            <div class="sidebar">
                <!-- Recent Applicants Section -->
                <section class="sidebar-section">
                    <h3 class="sidebar-title">Recent Applicants</h3>
                    <div id="recentApplicantsList">
                        <!-- Recent applicants will be dynamically inserted here -->
                    </div>
                    <button class="view-all-btn" id="viewAllApplicantsBtn">View All Applications</button>
                </section>

                <!-- Faculty Profile Section -->
                <section class="sidebar-section">
                    <div class="profile-header">
                        <div class="profile-avatar" id="profileAvatar">F</div>
                        <div class="profile-info">
                            <div class="profile-name" id="profileName">Loading...</div>
                            <div class="profile-position" id="profilePosition">Loading...</div>
                        </div>
                    </div>
                    <div class="profile-details">
                        <div class="profile-detail">
                            <span>Email:</span>
                            <span id="profileEmail">Loading...</span>
                        </div>
                        <div class="profile-detail">
                            <span>Office:</span>
                            <span id="profileOffice">Loading...</span>
                        </div>
                        <div class="profile-detail">
                            <span>Contact:</span>
                            <span id="profileContact">Loading...</span>
                        </div>
                    </div>
                    <a href="{% url 'faculty_profile' %}" class="edit-profile-btn" id="editProfileBtn">Edit Profile</a>
                </section>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>CSE Job Portal</h3>
                <p>Connecting CSE students and alumni with career opportunities in the industry.</p>
            </div>
            <div class="footer-section">
                <h3>Quick Links</h3>
                <ul class="footer-links">
                    <li><a href="{% url 'home' %}">Home</a></li>
                    <li><a href="{% url 'browse_opportunities' %}">Jobs</a></li>
                    <li><a href="{% url 'fcltlog' %}">Login</a></li>
                    <li><a href="{% url 'fcltreg' %}">Register</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Contact Us</h3>
                <div class="contact-info">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M6.36556 7.6821C7.302 9.3288 8.6712 10.698 10.3179 11.6344L11.2024 10.3961C11.4965 9.9845 12.0516 9.8573 12.4956 10.0998C13.9024 10.8683 15.4571 11.3353 17.0789 11.4637C17.599 11.5049 18 11.9389 18 12.4606V16.9234C18 17.4361 17.6122 17.8657 17.1022 17.9181C16.5723 17.9726 16.0377 18 15.5 18C6.93959 18 0 11.0604 0 2.5C0 1.96227 0.0274201 1.42771 0.0818901 0.89776C0.1343 0.38775 0.56394 0 1.07665 0H5.53942C6.0611 0 6.49513 0.40104 6.5363 0.92109C6.66467 2.54288 7.1317 4.09764 7.9002 5.50444C8.1427 5.9484 8.0155 6.50354 7.6039 6.79757L6.36556 7.6821ZM3.84425 7.0252L5.7442 5.66809C5.20547 4.50514 4.83628 3.27183 4.64727 2H2.00907C2.00303 2.16632 2 2.333 2 2.5C2 9.9558 8.0442 16 15.5 16C15.667 16 15.8337 15.997 16 15.9909V13.3527C14.7282 13.1637 13.4949 12.7945 12.3319 12.2558L10.9748 14.1558C10.4258 13.9425 9.8956 13.6915 9.3874 13.4061L9.3293 13.373C7.3697 12.2587 5.74134 10.6303 4.627 8.6707L4.59394 8.6126C4.30849 8.1044 4.05754 7.5742 3.84425 7.0252Z" fill="white"/>
                    </svg>
                    <span>02-58157091</span>
                </div>
                <div class="contact-info">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 3H21C21.5523 3 22 3.44772 22 4V20C22 20.5523 21.5523 21 21 21H3C2.44772 21 2 20.5523 2 20V4C2 3.44772 2.44772 3 3 3ZM12.0606 11.6829L5.64722 6.2377L4.35278 7.7623L12.0731 14.3171L19.6544 7.75616L18.3456 6.24384L12.0606 11.6829Z" fill="white"/>
                    </svg>
                    <span>cse-jobs@uap-bd.edu</span>
                </div>
            </div>
        </div>
        <div class="copyright">
            <p>&copy; 2025 CSE Department Job Portal. All rights reserved.</p>
        </div>
    </footer>

    <!-- Modals -->
    <!-- Opportunity Details Modal -->
    <div id="opportunityModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal()">×</button>
            <div id="modalContent"></div>
        </div>
    </div>

    <!-- Post Opportunity Modal -->
    <div id="postOpportunityModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal()">×</button>
            <h2 class="modal-title">Post New Opportunity</h2>
            <form id="newOpportunityForm">
                <div class="form-group">
                    <label for="opportunityTitle">Opportunity Title</label>
                    <input type="text" id="opportunityTitle" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="opportunityDepartment">Department</label>
                    <input type="text" id="opportunityDepartment" class="form-control" value="CSE Department • University Campus" required>
                </div>
                <div class="form-group">
                    <label for="opportunityDescription">Description</label>
                    <textarea id="opportunityDescription" class="form-control" rows="4" required></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="opportunityType">Type</label>
                        <select id="opportunityType" class="form-control" required>
                            <option value="teaching">Teaching Assistant</option>
                            <option value="research">Research Assistant</option>
                            <option value="part_time">Part Time</option>
                            <option value="internship">Internship</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="opportunityApplicants">Expected Applicants</label>
                        <input type="number" id="opportunityApplicants" class="form-control" placeholder="10">
                    </div>
                </div>
                <div class="form-group">
                    <label for="opportunityDeadline">Application Deadline</label>
                    <input type="date" id="opportunityDeadline" class="form-control" required>
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn btn-primary">Post Opportunity</button>
                    <button type="button" class="btn btn-secondary" onclick="saveAsDraft()">Save as Draft</button>
                    <button type="button" class="btn btn-cancel" onclick="closeModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Applicants Modal -->
    <div id="applicantsModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal()">×</button>
            <h2 class="modal-title" id="applicantsModalTitle">Applicants</h2>
            <div id="applicantsList">
                <!-- Applicants will be loaded here -->
            </div>
        </div>
    </div>

    <script>
// CSRF token helper
function getCSRFToken() {
    const name = 'csrftoken';
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// Current view state
let currentView = 'active';
let allOpportunities = [];
let filteredOpportunities = [];

// Initialize dashboard
document.addEventListener('DOMContentLoaded', function() {
    console.log('Initializing Faculty Dashboard...');

    // Load all data
    loadFacultyData();
    loadFacultyStats();
    loadOpportunities();
    loadRecentApplicants();

    // Set up event listeners
    setupEventListeners();

    // Initialize view
    updateActiveTab();
});

// Load faculty profile data
async function loadFacultyData() {
    try {
        const response = await fetch('/api/faculty/profile/');
        if (!response.ok) throw new Error('Failed to load faculty data');

        const data = await response.json();

        if (data.success) {
            const faculty = data.faculty;

            // Update welcome message and profile info
            document.getElementById('facultyName').textContent = faculty.full_name;
            document.getElementById('profileName').textContent = faculty.full_name;
            document.getElementById('profilePosition').textContent = faculty.position;
            document.getElementById('profileEmail').textContent = faculty.email;
            document.getElementById('profileOffice').textContent = faculty.office;
            document.getElementById('profileContact').textContent = faculty.contact;

            // Update profile avatar with initials
            const initials = getInitials(faculty.first_name, faculty.last_name);
            document.getElementById('profileAvatar').textContent = initials;
        } else {
            throw new Error(data.error || 'Failed to load faculty data');
        }
    } catch (error) {
        console.error('Error loading faculty data:', error);
        showError('Failed to load profile information');
        // Set fallback values
        document.getElementById('facultyName').textContent = 'Faculty Member';
        document.getElementById('profileName').textContent = 'Faculty Member';
        document.getElementById('profilePosition').textContent = 'Professor';
        document.getElementById('profileEmail').textContent = 'faculty@uap-bd.edu';
        document.getElementById('profileOffice').textContent = '7th floor, CSE dept. university campus';
        document.getElementById('profileContact').textContent = '+88-0167593251';
    }
}

// Helper function to get initials
function getInitials(firstName, lastName) {
    return (firstName.charAt(0) + lastName.charAt(0)).toUpperCase();
}

// Load faculty statistics
async function loadFacultyStats() {
    try {
        const response = await fetch('/api/faculty/stats/');
        if (!response.ok) throw new Error('Failed to load statistics');

        const stats = await response.json();

        document.getElementById('totalStudents').textContent = stats.total_students || 0;
        document.getElementById('totalOpportunities').textContent = stats.total_opportunities || 0;
        document.getElementById('totalHired').textContent = stats.total_hired || 0;
        document.getElementById('totalApplied').textContent = stats.total_applied || 0;
    } catch (error) {
        console.error('Error loading faculty stats:', error);
        showError('Failed to load statistics');

        // Set defaults on error
        document.getElementById('totalStudents').textContent = '0';
        document.getElementById('totalOpportunities').textContent = '0';
        document.getElementById('totalHired').textContent = '0';
        document.getElementById('totalApplied').textContent = '0';
    }
}

// Load opportunities from API
async function loadOpportunities() {
    try {
        showLoading('opportunityCardsContainer');

        const response = await fetch('/api/faculty/opportunities/');
        if (!response.ok) throw new Error('Failed to load opportunities');

        const opportunities = await response.json();
        allOpportunities = opportunities;
        filterOpportunitiesByView();
    } catch (error) {
        console.error('Error loading opportunities:', error);
        showError('Failed to load opportunities');
        renderOpportunityCards([]);
    }
}

// Load recent applicants
async function loadRecentApplicants() {
    try {
        const response = await fetch('/api/faculty/recent-applicants/');
        if (!response.ok) throw new Error('Failed to load recent applicants');

        const applicants = await response.json();
        renderRecentApplicants(applicants);
    } catch (error) {
        console.error('Error loading recent applicants:', error);
        renderRecentApplicants([]);
    }
}

// Render recent applicants in sidebar
function renderRecentApplicants(applicants) {
    const container = document.getElementById('recentApplicantsList');
    container.innerHTML = '';

    if (applicants.length === 0) {
        container.innerHTML = `
            <div class="applicant-item" style="text-align: center; color: var(--color-silver);">
                No recent applicants
            </div>
        `;
        return;
    }

    applicants.forEach(applicant => {
        const applicantItem = document.createElement('div');
        applicantItem.className = 'applicant-item';
        applicantItem.innerHTML = `
            <div class="applicant-name">${applicant.name}</div>
            <div class="applicant-position">${applicant.position}</div>
            <div class="applicant-time">${applicant.date} at ${applicant.time}</div>
        `;
        container.appendChild(applicantItem);
    });
}

// Filter opportunities based on current view
function filterOpportunitiesByView() {
    switch(currentView) {
        case 'active':
            filteredOpportunities = allOpportunities.filter(opportunity => opportunity.status === 'active');
            break;
        case 'pending':
            filteredOpportunities = allOpportunities.filter(opportunity => opportunity.status === 'pending');
            break;
        case 'closed':
            filteredOpportunities = allOpportunities.filter(opportunity => opportunity.status === 'closed');
            break;
        default:
            filteredOpportunities = allOpportunities;
    }
    renderOpportunityCards(filteredOpportunities);
}

// Render opportunity cards
function renderOpportunityCards(opportunities) {
    const container = document.getElementById('opportunityCardsContainer');
    container.innerHTML = '';

    if (opportunities.length === 0) {
        container.innerHTML = `
            <div style="text-align: center; padding: 40px; color: var(--color-lightsteelblue-200); font-size: var(--fs-20);">
                No ${currentView} opportunities found.
                ${currentView === 'active' ? '<br><button class="post-opportunity-btn" style="margin-top: 20px;" id="postNewOpportunityBtnEmpty">Post Your First Opportunity</button>' : ''}
            </div>
        `;

        // Re-attach event listener if button was recreated
        const postBtn = document.getElementById('postNewOpportunityBtnEmpty');
        if (postBtn) {
            postBtn.addEventListener('click', openPostOpportunityModal);
        }
        return;
    }

    opportunities.forEach((opportunity) => {
        const opportunityCard = document.createElement('div');
        opportunityCard.className = 'opportunity-card';
        opportunityCard.setAttribute('data-opportunity-id', opportunity.id);

        opportunityCard.innerHTML = `
            <div class="opportunity-card-content" style="position: relative; height: 100%;">
                ${getStatusBadge(opportunity.status)}

                <div class="opportunity-header">
                    <div>
                        <h3 class="opportunity-title">${escapeHtml(opportunity.title)}</h3>
                        <p class="opportunity-department">${escapeHtml(opportunity.department)}</p>
                    </div>
                </div>

                <div class="opportunity-details">
                    <div><strong>Type:</strong> ${getOpportunityTypeDisplay(opportunity.opportunity_type)}</div>
                    <div><strong>Applicants:</strong> ${opportunity.applicants_count}</div>
                </div>

                <div class="opportunity-meta">
                    <div><strong>Posted:</strong> ${opportunity.posted_date}</div>
                    <div><strong>Deadline:</strong> ${opportunity.deadline}</div>
                </div>

                <div class="opportunity-meta">
                    <div class="opportunity-tag">${getOpportunityTypeDisplay(opportunity.opportunity_type)}</div>
                    <div class="opportunity-tag">${opportunity.applicants_count} Applicants</div>
                </div>

                <div class="opportunity-actions">
                    <button class="action-btn view-applicants" onclick="event.stopPropagation(); viewApplicants(${opportunity.id})">
                        View Applicants (${opportunity.applicants_count})
                    </button>
                    <button class="action-btn edit-opportunity" onclick="event.stopPropagation(); editOpportunity(${opportunity.id})">
                        Edit Listing
                    </button>
                    <button class="action-btn close-opportunity" onclick="event.stopPropagation(); ${opportunity.status === 'active' ? 'closeOpportunity' : 'deleteOpportunity'}(${opportunity.id})">
                        ${opportunity.status === 'active' ? 'Close Opportunity' : 'Delete'}
                    </button>
                </div>
            </div>
        `;

        opportunityCard.addEventListener('click', function(e) {
            if (!e.target.closest('.opportunity-actions')) {
                viewOpportunityDetails(opportunity.id);
            }
        });

        container.appendChild(opportunityCard);
    });
}

// Helper function to get status badge HTML
function getStatusBadge(status) {
    const statusConfig = {
        'active': { text: 'Active', class: 'active' },
        'pending': { text: 'Pending Approval', class: 'pending' },
        'closed': { text: 'Closed', class: 'closed' },
        'draft': { text: 'Draft', class: 'draft' }
    };

    const config = statusConfig[status] || { text: status, class: 'default' };

    return `
        <div style="position: absolute; top: 20px; right: 20px;
                    background: ${getStatusColor(status)};
                    color: ${getStatusTextColor(status)};
                    padding: 5px 12px; border-radius: var(--br-10);
                    font-weight: 600; font-size: 14px;">
            ${config.text}
        </div>
    `;
}

// Helper function to get status color
function getStatusColor(status) {
    const colors = {
        'active': 'var(--color-lightgreen)',
        'pending': 'var(--color-silver)',
        'closed': 'var(--color-firebrick)',
        'draft': 'var(--color-lightsteelblue-200)'
    };
    return colors[status] || 'var(--color-silver)';
}

// Helper function to get status text color
function getStatusTextColor(status) {
    return status === 'active' ? 'var(--color-darkgreen)' : 'white';
}

// Helper function to escape HTML
function escapeHtml(unsafe) {
    return unsafe
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
}

// Helper function to display opportunity type
function getOpportunityTypeDisplay(type) {
    const typeMap = {
        'teaching': 'Teaching Assistant',
        'research': 'Research Assistant',
        'part_time': 'Part Time',
        'internship': 'Internship'
    };
    return typeMap[type] || type;
}

// Update active tab styling and filter
function updateActiveTab() {
    const activeTab = document.getElementById('activeTab');
    const pendingTab = document.getElementById('pendingTab');
    const closedTab = document.getElementById('closedTab');

    // Remove active class from all tabs
    [activeTab, pendingTab, closedTab].forEach(tab => {
        tab.classList.remove('active');
    });

    // Add active class to current tab
    document.getElementById(currentView + 'Tab').classList.add('active');

    // Filter opportunities
    filterOpportunitiesByView();
}

// Set up event listeners
function setupEventListeners() {
    // Tab switching
    const activeTab = document.getElementById('activeTab');
    const pendingTab = document.getElementById('pendingTab');
    const closedTab = document.getElementById('closedTab');

    activeTab.addEventListener('click', function() {
        currentView = 'active';
        updateActiveTab();
    });

    pendingTab.addEventListener('click', function() {
        currentView = 'pending';
        updateActiveTab();
    });

    closedTab.addEventListener('click', function() {
        currentView = 'closed';
        updateActiveTab();
    });

    // Post new opportunity button
    const postNewOpportunityBtn = document.getElementById('postNewOpportunityBtn');
    postNewOpportunityBtn.addEventListener('click', openPostOpportunityModal);

    // Edit profile button
    const editProfileBtn = document.getElementById('editProfileBtn');
    editProfileBtn.addEventListener('click', editProfile);

    // View all applicants button
    const viewAllApplicantsBtn = document.getElementById('viewAllApplicantsBtn');
    viewAllApplicantsBtn.addEventListener('click', viewAllApplicants);

    // New opportunity form submission
    const newOpportunityForm = document.getElementById('newOpportunityForm');
    if (newOpportunityForm) {
        newOpportunityForm.addEventListener('submit', function(e) {
            e.preventDefault();
            submitNewOpportunity();
        });
    }
}

// Modal functions
function showModal(modalId) {
    document.getElementById(modalId).style.display = 'flex';
}

function closeModal() {
    const modals = document.querySelectorAll('.modal');
    modals.forEach(modal => {
        modal.style.display = 'none';
    });
}

function openPostOpportunityModal() {
    showModal('postOpportunityModal');
}

// Opportunity management functions
function viewOpportunityDetails(opportunityId) {
    const opportunity = allOpportunities.find(o => o.id === opportunityId);
    if (opportunity) {
        const opportunityDetails = `
            <h2 class="modal-title">${opportunity.title}</h2>
            <h3 style="color: var(--color-gray); margin-bottom: 15px;">${opportunity.department}</h3>

            <div style="margin-bottom: 15px;">
                <strong>Type:</strong> ${getOpportunityTypeDisplay(opportunity.opportunity_type)}<br>
                <strong>Applicants:</strong> ${opportunity.applicants_count}<br>
                <strong>Expected Applicants:</strong> ${opportunity.expected_applicants}<br>
                <strong>Deadline:</strong> ${opportunity.deadline}<br>
                <strong>Posted:</strong> ${opportunity.posted_date}<br>
                <strong>Status:</strong> ${opportunity.status.charAt(0).toUpperCase() + opportunity.status.slice(1)}
            </div>

            <div style="margin-bottom: 20px;">
                <strong>Description:</strong><br>
                ${opportunity.description}
            </div>

            ${opportunity.requirements && opportunity.requirements.length > 0 ? `
            <div style="margin-bottom: 20px;">
                <strong>Requirements:</strong><br>
                ${opportunity.requirements.map(req => `• ${req}`).join('<br>')}
            </div>
            ` : ''}

            <div style="text-align: center;">
                <button class="btn btn-primary" onclick="editOpportunity(${opportunity.id})">Edit Opportunity</button>
                <button class="btn btn-cancel" onclick="${opportunity.status === 'active' ? 'closeOpportunity' : 'deleteOpportunity'}(${opportunity.id})">
                    ${opportunity.status === 'active' ? 'Close Opportunity' : 'Delete Opportunity'}
                </button>
            </div>
        `;

        document.getElementById('modalContent').innerHTML = opportunityDetails;
        showModal('opportunityModal');
    }
}

async function viewApplicants(opportunityId) {
    try {
        const response = await fetch(`/api/opportunities/${opportunityId}/applicants/`);
        if (!response.ok) throw new Error('Failed to load applicants');

        const applicants = await response.json();

        const opportunity = allOpportunities.find(o => o.id === opportunityId);
        const applicantsContent = `
            <h2 class="modal-title">Applicants for ${opportunity.title}</h2>
            <h3 style="color: var(--color-gray); margin-bottom: 15px;">${applicants.length} Applicants</h3>

            <div style="max-height: 400px; overflow-y: auto;">
                ${applicants.length > 0 ? applicants.map(applicant => `
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 5px; margin-bottom: 10px;">
                        <strong>${applicant.name}</strong><br>
                        <small>Student ID: ${applicant.student_id}</small><br>
                        <small>Email: ${applicant.email}</small><br>
                        <small>Graduation Year: ${applicant.graduation_year}</small><br>
                        <small>Applied: ${applicant.applied_at}</small><br>
                        <small>Status: ${applicant.status}</small>
                    </div>
                `).join('') : `
                    <div style="text-align: center; padding: 20px; color: var(--color-silver);">
                        No applicants yet.
                    </div>
                `}
            </div>
        `;

        document.getElementById('modalContent').innerHTML = applicantsContent;
        showModal('opportunityModal');
    } catch (error) {
        console.error('Error loading applicants:', error);
        alert('Failed to load applicants.');
    }
}

function editOpportunity(opportunityId) {
    const opportunity = allOpportunities.find(o => o.id === opportunityId);
    alert(`Editing opportunity: ${opportunity.title}`);
    closeModal();
}

async function closeOpportunity(opportunityId) {
    const opportunity = allOpportunities.find(o => o.id === opportunityId);
    if (opportunity && confirm(`Are you sure you want to close "${opportunity.title}"?`)) {
        try {
            const response = await fetch(`/api/opportunities/${opportunityId}/update/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCSRFToken(),
                },
                body: JSON.stringify({ status: 'closed' })
            });

            const result = await response.json();
            if (result.success) {
                alert(`Opportunity "${opportunity.title}" has been closed.`);
                closeModal();
                loadOpportunities(); // Reload opportunities
                loadFacultyStats(); // Reload stats
            } else {
                alert('Error: ' + result.error);
            }
        } catch (error) {
            console.error('Error closing opportunity:', error);
            alert('Failed to close opportunity. Please try again.');
        }
    }
}

async function deleteOpportunity(opportunityId) {
    const opportunity = allOpportunities.find(o => o.id === opportunityId);
    if (opportunity && confirm(`Are you sure you want to delete "${opportunity.title}"? This action cannot be undone.`)) {
        try {
            const response = await fetch(`/api/opportunities/${opportunityId}/delete/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCSRFToken(),
                }
            });

            const result = await response.json();
            if (result.success) {
                alert(`Opportunity "${opportunity.title}" has been deleted.`);
                closeModal();
                loadOpportunities(); // Reload opportunities
                loadFacultyStats(); // Reload stats
            } else {
                alert('Error: ' + result.error);
            }
        } catch (error) {
            console.error('Error deleting opportunity:', error);
            alert('Failed to delete opportunity. Please try again.');
        }
    }
}

async function submitNewOpportunity() {
    const form = document.getElementById('newOpportunityForm');

    const opportunityData = {
        title: document.getElementById('opportunityTitle').value,
        department: document.getElementById('opportunityDepartment').value,
        opportunity_type: document.getElementById('opportunityType').value,
        description: document.getElementById('opportunityDescription').value,
        expected_applicants: parseInt(document.getElementById('opportunityApplicants').value) || 0,
        deadline: document.getElementById('opportunityDeadline').value,

    };

    try {
        const response = await fetch('/api/faculty/opportunities/post/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCSRFToken(),
            },
            body: JSON.stringify(opportunityData)
        });

        const result = await response.json();
        if (result.success) {
            alert('Opportunity posted successfully!');
            closeModal();
            form.reset();
            loadOpportunities(); // Reload opportunities
            loadFacultyStats(); // Reload stats
        } else {
            alert('Error: ' + result.error);
        }
    } catch (error) {
        console.error('Error posting opportunity:', error);
        alert('Failed to post opportunity. Please try again.');
    }
}

function saveAsDraft() {
    alert('Opportunity saved as draft!');
    closeModal();
}

function editProfile() {
    alert('Edit profile functionality would go here.');
}

function viewAllApplicants() {
    alert('View all applicants functionality would go here.');
}

// Show loading state
function showLoading(containerId) {
    const container = document.getElementById(containerId);
    container.innerHTML = `
        <div style="text-align: center; padding: 40px; color: var(--color-lightsteelblue-200);">
            <div style="font-size: 18px; margin-bottom: 10px;">Loading...</div>
            <div class="loading-spinner"></div>
        </div>
    `;
}

// Show error message
function showError(message) {
    // You can implement a toast notification system here
    console.error('Error:', message);
    alert(message); // Simple alert for now
}

// Add loading spinner CSS
const loadingStyles = `
    .loading-spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #3498db;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 2s linear infinite;
        margin: 0 auto;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
`;

// Inject loading styles
const styleSheet = document.createElement("style");
styleSheet.innerText = loadingStyles;
document.head.appendChild(styleSheet);

// Close modal when clicking outside
window.addEventListener('click', function(e) {
    const modals = document.querySelectorAll('.modal');
    modals.forEach(modal => {
        if (e.target === modal) {
            closeModal();
        }
    });
});
    </script>
</body>
</html>